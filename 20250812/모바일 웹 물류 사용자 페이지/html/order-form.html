<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°°ì†¡ ì ‘ìˆ˜ - YCS ë¬¼ë¥˜ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="navigation.js"></script>
    <style>
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.6s ease-out; }
        .shadow-blue-lg { box-shadow: 0 10px 25px -3px rgba(59, 130, 246, 0.1), 0 4px 6px -2px rgba(59, 130, 246, 0.05); }
        .shadow-blue { box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1), 0 2px 4px -1px rgba(59, 130, 246, 0.06); }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 space-y-6">
    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 hidden animate-slide-up">
        <div id="messageAlert" class="shadow-blue-lg px-6 py-4 rounded-lg flex items-center gap-3">
            <i id="messageIcon" class="h-5 w-5"></i>
            <p id="messageText"></p>
        </div>
    </div>

    <!-- Validation Messages -->
    <div id="validationContainer" class="space-y-2 hidden">
        <!-- Validation messages will be dynamically inserted here -->
    </div>

    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <button onclick="navigateBack()" class="text-blue-600 hover:text-blue-700 hover:bg-blue-50 p-2 rounded-lg transition-colors">
            <i data-lucide="arrow-left" class="h-4 w-4 mr-2 inline"></i>
            ë’¤ë¡œê°€ê¸°
        </button>
        <div>
            <h1 class="text-xl text-blue-900 font-bold">ë°°ì†¡ ì ‘ìˆ˜</h1>
            <p class="text-sm text-blue-600">ìƒˆë¡œìš´ ë°°ì†¡ì„ ì ‘ìˆ˜í•´ë³´ì„¸ìš” - ì°½ê³  ë„ì°© í›„ ì²­êµ¬ì„œ ë°œí–‰</p>
        </div>
    </div>

    <!-- Customer Info Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900">ì£¼ë¬¸ì ì •ë³´</h2>
        </div>
        <div class="p-6 space-y-4">
            <div class="grid grid-cols-1 gap-4">
                <div class="space-y-2">
                    <label class="text-blue-900 font-medium">ê³ ê° ì•„ì´ë””</label>
                    <input id="customerId" disabled class="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-md font-mono">
                </div>
                <div class="space-y-2">
                    <label class="text-blue-900 font-medium">ì´ë¦„</label>
                    <input id="customerName" disabled class="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-md">
                </div>
                <div class="space-y-2">
                    <label class="text-blue-900 font-medium">ì´ë©”ì¼</label>
                    <input id="customerEmail" disabled class="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-md">
                </div>
                <div class="space-y-2">
                    <label class="text-blue-900 font-medium">ì—°ë½ì²˜</label>
                    <input id="customerPhone" disabled class="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-md">
                </div>
                <div id="customerCompanyField" class="space-y-2 hidden">
                    <label class="text-blue-900 font-medium">íšŒì‚¬ëª…</label>
                    <input id="customerCompany" disabled class="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-md">
                </div>
            </div>
        </div>
    </div>

    <!-- Tracking Number Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900 flex items-center gap-2">
                ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸
                <span class="px-2 py-1 text-xs bg-red-100 text-red-700 border border-red-200 rounded-full">í•„ìˆ˜</span>
            </h2>
        </div>
        <div class="p-6 space-y-4">
            <div class="space-y-2">
                <label class="text-blue-900 font-medium">ì†¡ì¥ë²ˆí˜¸ *</label>
                <input id="trackingNumber" type="text" placeholder="ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none" required>
                <p class="text-xs text-blue-600">
                    ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ì£¼ë¬¸ì„ ì ‘ìˆ˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>

    <!-- Shipping Info Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900">ë°°ì†¡ ì •ë³´</h2>
        </div>
        <div class="p-6 space-y-6">
            <div class="space-y-3">
                <label class="text-blue-900 font-medium">ë°°ì†¡ ìœ í˜•</label>
                <div class="grid grid-cols-2 gap-4">
                    <div id="seaShippingOption" class="p-4 rounded-lg border-2 border-blue-500 bg-blue-50 flex items-center gap-3 transition-all cursor-pointer">
                        <input type="radio" name="shippingType" value="sea" id="seaShipping" checked class="text-blue-600">
                        <div>
                            <label for="seaShipping" class="font-medium cursor-pointer">í•´ìƒìš´ì†¡</label>
                            <p class="text-sm text-gray-600">ê²½ì œì , 15-30ì¼</p>
                        </div>
                    </div>
                    <div id="airShippingOption" class="p-4 rounded-lg border-2 border-gray-200 flex items-center gap-3 transition-all cursor-pointer">
                        <input type="radio" name="shippingType" value="air" id="airShipping" class="text-blue-600">
                        <div>
                            <label for="airShipping" class="font-medium cursor-pointer">í•­ê³µìš´ì†¡</label>
                            <p class="text-sm text-gray-600">ì‹ ì†, 3-7ì¼ (ì¶”ê°€ ê²€ì¦ í•„ìš”)</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <label class="text-blue-900 font-medium">ë„ì°© êµ­ê°€</label>
                <select id="destinationCountry" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                    <option value="thailand">ğŸ‡¹ğŸ‡­ íƒœêµ­</option>
                    <option value="vietnam">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨</option>
                    <option value="philippines">ğŸ‡µğŸ‡­ í•„ë¦¬í•€</option>
                    <option value="indonesia">ğŸ‡®ğŸ‡© ì¸ë„ë„¤ì‹œì•„</option>
                </select>
            </div>

            <div class="space-y-3">
                <label class="text-blue-900 font-medium">ìš°í¸ë²ˆí˜¸</label>
                <input id="postalCode" type="text" placeholder="5ìë¦¬ ìˆ«ì (ì˜ˆ: 10110)" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                <p id="postalCodeGuide" class="text-xs text-blue-600">
                    5ìë¦¬ ìˆ«ì (ì˜ˆ: 10110)
                </p>
            </div>
        </div>
    </div>

    <!-- Recipient Info Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900">
                ìˆ˜ì·¨ì¸ ì •ë³´
                <span id="recipientRequiredBadge" class="hidden ml-2 px-2 py-1 text-xs bg-red-100 text-red-700 border border-red-200 rounded-full">í•„ìˆ˜</span>
            </h2>
        </div>
        <div class="p-6 space-y-4">
            <div class="space-y-2">
                <label class="text-blue-900 font-medium">ìˆ˜ì·¨ì¸ ì´ë¦„</label>
                <input id="recipientName" type="text" placeholder="ìˆ˜ì·¨ì¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
            </div>
            <div class="space-y-2">
                <label class="text-blue-900 font-medium">ìˆ˜ì·¨ì¸ ì—°ë½ì²˜</label>
                <input id="recipientPhone" type="text" placeholder="ìˆ˜ì·¨ì¸ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
            </div>
            <div class="space-y-2">
                <label class="text-blue-900 font-medium">ìˆ˜ì·¨ì¸ ì£¼ì†Œ</label>
                <textarea id="recipientAddress" placeholder="ìˆ˜ì·¨ì¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full min-h-24 px-4 py-3 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none"></textarea>
            </div>
            <div class="space-y-2">
                <label class="text-blue-900 font-medium">ìˆ˜ì·¨ì¸ ìš°í¸ë²ˆí˜¸</label>
                <input id="recipientPostalCode" type="text" placeholder="5ìë¦¬ ìˆ«ì (ì˜ˆ: 10110)" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
            </div>
        </div>
    </div>

    <!-- Items Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-blue-900">í’ˆëª© ì •ë³´</h2>
                <div class="flex gap-2">
                    <button id="bulkUploadBtn" onclick="openBulkUploadModal()" class="hidden px-4 py-2 text-sm border border-green-200 text-green-600 hover:bg-green-50 hover:text-green-700 hover:border-green-300 rounded-lg transition-colors">
                        <i data-lucide="file-spreadsheet" class="h-4 w-4 mr-2 inline"></i>
                        ì¼ê´„ë“±ë¡
                    </button>
                    <button id="templateBtn" onclick="downloadTemplate()" class="hidden px-4 py-2 text-sm border border-orange-200 text-orange-600 hover:bg-orange-50 hover:text-orange-700 hover:border-orange-300 rounded-lg transition-colors">
                        <i data-lucide="download" class="h-4 w-4 mr-2 inline"></i>
                        ì–‘ì‹ë°›ê¸°
                    </button>
                    <button onclick="addOrderItem()" class="px-4 py-2 text-sm bg-blue-600/20 hover:bg-blue-600 border border-blue-300/50 hover:border-blue-500 text-blue-700 hover:text-white transition-all duration-300 rounded-lg">
                        <i data-lucide="plus" class="h-4 w-4 mr-2 inline"></i>
                        í’ˆëª© ì¶”ê°€
                    </button>
                </div>
            </div>
        </div>
        <div id="orderItemsContainer" class="p-6 space-y-6">
            <!-- Order items will be dynamically inserted here -->
        </div>
    </div>

    <!-- Special Requests Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900">íŠ¹ë³„ ìš”ì²­ì‚¬í•­</h2>
        </div>
        <div class="p-6">
            <textarea id="specialRequests" placeholder="íŠ¹ë³„í•œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”..." class="w-full min-h-24 px-4 py-3 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none"></textarea>
        </div>
    </div>

    <!-- Repacking Service Card -->
    <div class="bg-white shadow-blue border border-blue-100 rounded-lg">
        <div class="p-6 border-b border-blue-100">
            <h2 class="text-lg font-semibold text-blue-900">ë¦¬íŒ¨í‚¹ ì„œë¹„ìŠ¤</h2>
        </div>
        <div class="p-6">
            <div class="flex items-center space-x-3">
                <input type="checkbox" id="repacking" class="w-4 h-4 text-blue-600 border-blue-200 rounded focus:ring-blue-200">
                <div>
                    <label for="repacking" class="font-medium cursor-pointer">ë¦¬íŒ¨í‚¹ ì„œë¹„ìŠ¤ ì‹ ì²­</label>
                    <p class="text-sm text-gray-600">
                        ì°½ê³  ë„ì°© í›„ ìƒí’ˆ ìƒíƒœì— ë”°ë¼ ë¦¬íŒ¨í‚¹ ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Buttons -->
    <div class="flex gap-4 pb-20">
        <button onclick="handleCancel()" class="flex-1 h-12 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
            ì·¨ì†Œ
        </button>
        <button onclick="handleSave()" id="saveBtn" class="flex-1 h-12 border border-blue-200 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
            ì„ì‹œì €ì¥
        </button>
        <button onclick="handleSubmit()" id="submitBtn" class="flex-1 h-12 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors">
            ì ‘ìˆ˜ì™„ë£Œ
        </button>
    </div>

    <!-- HS Code Search Modal -->
    <div id="hsCodeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-blue-900">HS CODE í’ˆëª© ì¡°íšŒ</h3>
                <p class="text-sm text-gray-600 mt-2">
                    HS CODE ë˜ëŠ” í’ˆëª©ëª…ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ í•´ë‹¹ í’ˆëª©ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    API ì¡°íšŒì— ì‹¤íŒ¨í•œ ê²½ìš° ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </p>
            </div>
            
            <div class="p-6 space-y-4">
                <div class="relative">
                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"></i>
                    <input id="hsCodeSearch" placeholder="HS CODE ë˜ëŠ” í’ˆëª©ëª… ê²€ìƒ‰" class="w-full pl-10 pr-10 h-12 border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                    <div id="hsCodeLoading" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2">
                        <div class="w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                </div>
                
                <div id="hsCodeResults" class="max-h-60 overflow-y-auto space-y-2">
                    <!-- Search results will be dynamically inserted here -->
                </div>
                
                <div class="flex gap-3">
                    <button onclick="closeHSCodeModal()" class="flex-1 h-12 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg max-w-lg w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-blue-900">í’ˆëª© ì¼ê´„ë“±ë¡</h3>
                <p class="text-sm text-gray-600 mt-2">
                    ì–‘ì‹ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì‘ì„±í•œ í›„ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ì—¬ëŸ¬ í’ˆëª©ì„ í•œ ë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- Template Download -->
                <div class="p-4 bg-blue-50/50 rounded-lg border border-blue-100/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-blue-900">1. ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</h3>
                            <p class="text-sm text-blue-600">ë¨¼ì € ì–‘ì‹ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
                        </div>
                        <button onclick="downloadTemplate()" class="px-4 py-2 text-sm border border-blue-200 text-blue-600 hover:bg-blue-50 rounded-lg">
                            <i data-lucide="download" class="h-4 w-4 mr-2 inline"></i>
                            ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>

                <!-- File Upload -->
                <div class="space-y-3">
                    <h3 class="font-medium text-blue-900">2. ì‘ì„±ëœ íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <div class="relative">
                        <input id="bulkFile" type="file" accept=".csv,.xlsx" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="h-20 px-4 border-2 border-dashed border-blue-200 hover:border-blue-300 bg-blue-50/30 hover:bg-blue-50/50 transition-all duration-300 rounded-lg flex items-center gap-3 cursor-pointer">
                            <i data-lucide="package" class="h-8 w-8 text-blue-600"></i>
                            <div>
                                <p id="bulkFileText" class="font-medium text-blue-700">
                                    íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”
                                </p>
                                <p class="text-sm text-blue-600">CSV ë˜ëŠ” Excel íŒŒì¼ (ìµœëŒ€ 10MB)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upload Button -->
                <div class="flex gap-4">
                    <button onclick="closeBulkUploadModal()" class="flex-1 h-12 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg">
                        ì·¨ì†Œ
                    </button>
                    <button onclick="processBulkUpload()" id="bulkUploadSubmitBtn" class="flex-1 h-12 bg-blue-600 text-white hover:bg-blue-700 rounded-lg disabled:opacity-50" disabled>
                        ì¼ê´„ë“±ë¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let orderItems = [];
        let validationMessages = [];
        let isLoading = false;
        let currentItemId = '';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            lucide.createIcons();
        });

        function initializePage() {
            // Check if user is logged in
            const userData = localStorage.getItem('currentUser');
            if (!userData) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userData);
            
            // Initialize customer info
            initializeCustomerInfo();
            
            // Initialize order items
            addOrderItem();
            
            // Add event listeners
            addEventListeners();
            
            // Initial validation
            validateForm();
        }

        function initializeCustomerInfo() {
            // Generate customer ID
            const prefix = currentUser.type === 'corporate' ? 'KYC' : 'KYP';
            const number = String(Math.floor(Math.random() * 9000) + 1000).padStart(3, '0');
            const customerId = `${prefix}${number}`;
            
            document.getElementById('customerId').value = customerId;
            document.getElementById('customerName').value = currentUser.name;
            document.getElementById('customerEmail').value = currentUser.email;
            document.getElementById('customerPhone').value = currentUser.phone || '';
            
            if (currentUser.type !== 'general' && currentUser.companyName) {
                document.getElementById('customerCompanyField').classList.remove('hidden');
                document.getElementById('customerCompany').value = currentUser.companyName;
            }
            
            // Show bulk upload buttons for corporate users
            if (currentUser.type === 'corporate') {
                document.getElementById('bulkUploadBtn').classList.remove('hidden');
                document.getElementById('templateBtn').classList.remove('hidden');
            }
        }

        function addEventListeners() {
            // Shipping type change
            document.querySelectorAll('input[name="shippingType"]').forEach(radio => {
                radio.addEventListener('change', updateShippingType);
            });
            
            // Country change
            document.getElementById('destinationCountry').addEventListener('change', updateCountryInfo);
            
            // Real-time validation
            document.getElementById('trackingNumber').addEventListener('input', validateForm);
            
            // Bulk file upload
            document.getElementById('bulkFile').addEventListener('change', handleBulkFileSelect);
            
            // HS Code search
            document.getElementById('hsCodeSearch').addEventListener('input', debounce(searchHSCode, 500));
        }

        function updateShippingType() {
            const shippingType = document.querySelector('input[name="shippingType"]:checked').value;
            
            // Update UI
            document.querySelectorAll('[id$="ShippingOption"]').forEach(option => {
                option.className = 'p-4 rounded-lg border-2 border-gray-200 flex items-center gap-3 transition-all cursor-pointer';
            });
            
            document.getElementById(shippingType + 'ShippingOption').className = 'p-4 rounded-lg border-2 border-blue-500 bg-blue-50 flex items-center gap-3 transition-all cursor-pointer';
            
            validateForm();
        }

        function updateCountryInfo() {
            const country = document.getElementById('destinationCountry').value;
            const guides = {
                thailand: '5ìë¦¬ ìˆ«ì (ì˜ˆ: 10110)',
                vietnam: '6ìë¦¬ ìˆ«ì (ì˜ˆ: 100000)', 
                philippines: '4ìë¦¬ ìˆ«ì (ì˜ˆ: 1000)',
                indonesia: '5ìë¦¬ ìˆ«ì (ì˜ˆ: 10110)'
            };
            
            const guide = guides[country] || '4-6ìë¦¬ ìˆ«ì';
            document.getElementById('postalCodeGuide').textContent = guide;
            document.getElementById('postalCode').placeholder = guide;
            document.getElementById('recipientPostalCode').placeholder = guide;
        }

        function addOrderItem() {
            const itemId = Date.now().toString();
            const itemDiv = document.createElement('div');
            itemDiv.id = `item-${itemId}`;
            itemDiv.className = 'p-4 border-2 border-blue-100/50 rounded-lg space-y-4 bg-blue-50/30';
            
            itemDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <h4 class="font-medium text-blue-900">í’ˆëª© ${orderItems.length + 1}</h4>
                    ${orderItems.length > 0 ? `
                        <button onclick="removeOrderItem('${itemId}')" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors">
                            <i data-lucide="trash-2" class="h-4 w-4"></i>
                        </button>
                    ` : ''}
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <!-- HS CODE -->
                    <div class="space-y-2">
                        <label class="text-blue-900 font-medium">HS CODE</label>
                        <div class="flex gap-2">
                            <input id="hscode-${itemId}" type="text" placeholder="HS CODE ì…ë ¥" class="flex-1 h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                            <button onclick="openHSCodeModal('${itemId}')" class="h-12 px-3 border border-blue-200 text-blue-600 hover:bg-blue-50 rounded-md">
                                <i data-lucide="search" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label class="text-blue-900 font-medium">í’ˆëª©ëª…</label>
                        <input id="description-${itemId}" type="text" placeholder="í’ˆëª©ëª… ì…ë ¥" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                    </div>

                    <!-- Quantity and Weight -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-blue-900 font-medium">ìˆ˜ëŸ‰</label>
                            <input id="quantity-${itemId}" type="number" placeholder="ìˆ˜ëŸ‰" min="1" value="1" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-blue-900 font-medium">ì¤‘ëŸ‰ (kg)</label>
                            <input id="weight-${itemId}" type="number" step="0.1" placeholder="ì¤‘ëŸ‰" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                        </div>
                    </div>

                    <!-- Unit Price -->
                    <div class="space-y-2">
                        <label class="text-blue-900 font-medium flex items-center gap-2">
                            ë‹¨ê°€ (THB)
                            <span id="airValidationBadge-${itemId}" class="hidden px-2 py-1 text-xs border border-gray-300 rounded-full">í•­ê³µìš´ì†¡ ê²€ì¦</span>
                        </label>
                        <input id="unitPrice-${itemId}" type="number" step="0.01" placeholder="ë‹¨ê°€ (íƒœêµ­ ë°”íŠ¸)" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                        <div id="priceWarning-${itemId}" class="hidden text-xs text-orange-600">
                            âš ï¸ THB 1,500 ì´ˆê³¼ ì‹œ ìˆ˜ì·¨ì¸ ì •ë³´ ë° ì¶”ê°€ ì„œë¥˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <!-- Dimensions -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="space-y-2">
                                <label class="text-blue-900 font-medium">ê°€ë¡œ (cm)</label>
                                <input id="width-${itemId}" type="number" step="0.1" placeholder="ê°€ë¡œ" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                            </div>
                            <div class="space-y-2">
                                <label class="text-blue-900 font-medium">ì„¸ë¡œ (cm)</label>
                                <input id="height-${itemId}" type="number" step="0.1" placeholder="ì„¸ë¡œ" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                            </div>
                            <div class="space-y-2">
                                <label class="text-blue-900 font-medium">ë†’ì´ (cm)</label>
                                <input id="depth-${itemId}" type="number" step="0.1" placeholder="ë†’ì´" class="w-full h-12 px-4 border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-md outline-none">
                            </div>
                        </div>

                        <!-- CBM Display -->
                        <div id="cbmDisplay-${itemId}" class="hidden p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-green-900">CBM ìë™ê³„ì‚°</p>
                                    <p id="cbmCalculation-${itemId}" class="text-sm text-green-700"></p>
                                </div>
                                <div class="text-right">
                                    <p id="cbmValue-${itemId}" class="font-bold text-green-900"></p>
                                    <p class="text-xs text-green-600">ì†Œìˆ˜ì  3ì§¸ìë¦¬ ë°˜ì˜¬ë¦¼</p>
                                </div>
                            </div>
                        </div>

                        <!-- Volumetric Weight Display -->
                        <div id="volumetricDisplay-${itemId}" class="hidden p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-blue-900">EMS ë¶€í”¼ë¬´ê²Œ</p>
                                    <p id="volumetricCalculation-${itemId}" class="text-sm text-blue-700"></p>
                                </div>
                                <div class="text-right">
                                    <span id="volumetricScore-${itemId}" class="px-2 py-1 text-xs rounded-full"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('orderItemsContainer').appendChild(itemDiv);
            
            // Add item to array
            orderItems.push({
                id: itemId,
                hscode: '',
                description: '',
                quantity: 1,
                weight: 0,
                width: 0,
                height: 0,
                depth: 0,
                unitPrice: 0,
                cbm: 0
            });
            
            // Add event listeners for this item
            addItemEventListeners(itemId);
            
            lucide.createIcons();
        }

        function addItemEventListeners(itemId) {
            // Dimension change listeners for CBM calculation
            ['width', 'height', 'depth'].forEach(dimension => {
                document.getElementById(`${dimension}-${itemId}`).addEventListener('input', () => {
                    calculateCBM(itemId);
                    calculateVolumetricWeight(itemId);
                });
            });
            
            // Weight change listener
            document.getElementById(`weight-${itemId}`).addEventListener('input', () => {
                calculateVolumetricWeight(itemId);
            });
            
            // Unit price change listener
            document.getElementById(`unitPrice-${itemId}`).addEventListener('input', () => {
                validateAirShipping();
            });
        }

        function removeOrderItem(itemId) {
            document.getElementById(`item-${itemId}`).remove();
            orderItems = orderItems.filter(item => item.id !== itemId);
            
            // Update item numbers
            updateItemNumbers();
        }

        function updateItemNumbers() {
            const itemDivs = document.querySelectorAll('[id^="item-"]');
            itemDivs.forEach((div, index) => {
                const titleElement = div.querySelector('h4');
                titleElement.textContent = `í’ˆëª© ${index + 1}`;
            });
        }

        function calculateCBM(itemId) {
            const width = parseFloat(document.getElementById(`width-${itemId}`).value) || 0;
            const height = parseFloat(document.getElementById(`height-${itemId}`).value) || 0;
            const depth = parseFloat(document.getElementById(`depth-${itemId}`).value) || 0;
            
            if (width > 0 && height > 0 && depth > 0) {
                const cbm = Math.round((width * height * depth) / 1000000 * 1000) / 1000;
                
                document.getElementById(`cbmDisplay-${itemId}`).classList.remove('hidden');
                document.getElementById(`cbmCalculation-${itemId}`).textContent = `${width} Ã— ${height} Ã— ${depth} = ${cbm} mÂ³`;
                document.getElementById(`cbmValue-${itemId}`).textContent = `${cbm} mÂ³`;
                
                // Update item in array
                const item = orderItems.find(item => item.id === itemId);
                if (item) {
                    item.cbm = cbm;
                    item.width = width;
                    item.height = height;
                    item.depth = depth;
                }
            } else {
                document.getElementById(`cbmDisplay-${itemId}`).classList.add('hidden');
            }
        }

        function calculateVolumetricWeight(itemId) {
            const width = parseFloat(document.getElementById(`width-${itemId}`).value) || 0;
            const height = parseFloat(document.getElementById(`height-${itemId}`).value) || 0;
            const depth = parseFloat(document.getElementById(`depth-${itemId}`).value) || 0;
            const weight = parseFloat(document.getElementById(`weight-${itemId}`).value) || 0;
            
            if (width > 0 && height > 0 && depth > 0) {
                const volumetricWeight = (width * height * depth) / 6000;
                const ratio = volumetricWeight / Math.max(weight, 0.1);
                
                let score = 'ë‚®ìŒ';
                let scoreClass = 'bg-green-100 text-green-700';
                
                if (ratio > 2) {
                    score = 'ë†’ìŒ';
                    scoreClass = 'bg-red-100 text-red-700';
                } else if (ratio > 1.5) {
                    score = 'ë³´í†µ';
                    scoreClass = 'bg-yellow-100 text-yellow-700';
                }
                
                document.getElementById(`volumetricDisplay-${itemId}`).classList.remove('hidden');
                document.getElementById(`volumetricCalculation-${itemId}`).textContent = `${width} Ã— ${height} Ã— ${depth} Ã· 6000 = ${volumetricWeight.toFixed(2)}kg`;
                
                const scoreElement = document.getElementById(`volumetricScore-${itemId}`);
                scoreElement.textContent = score;
                scoreElement.className = `px-2 py-1 text-xs rounded-full ${scoreClass}`;
            } else {
                document.getElementById(`volumetricDisplay-${itemId}`).classList.add('hidden');
            }
        }

        function validateAirShipping() {
            const shippingType = document.querySelector('input[name="shippingType"]:checked').value;
            const trackingNumber = document.getElementById('trackingNumber').value.trim();
            
            validationMessages = [];
            
            if (shippingType === 'air') {
                if (!trackingNumber) {
                    validationMessages.push({
                        type: 'error',
                        message: 'í•­ê³µ ìš´ì†¡ì˜ ê²½ìš° ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤.'
                    });
                }
                
                orderItems.forEach((item, index) => {
                    const unitPrice = parseFloat(document.getElementById(`unitPrice-${item.id}`).value) || 0;
                    
                    if (unitPrice > 1500) {
                        const recipientName = document.getElementById('recipientName').value.trim();
                        const recipientPhone = document.getElementById('recipientPhone').value.trim();
                        const recipientAddress = document.getElementById('recipientAddress').value.trim();
                        
                        if (!recipientName || !recipientPhone || !recipientAddress) {
                            validationMessages.push({
                                type: 'error',
                                message: `í’ˆëª© ${index + 1}: ë‹¨ê°€ THB 1,500 ì´ˆê³¼ ì‹œ ìˆ˜ì·¨ì¸ ì •ë³´ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤.`
                            });
                        } else {
                            validationMessages.push({
                                type: 'warning',
                                message: `í’ˆëª© ${index + 1}: ë‹¨ê°€ê°€ THB 1,500ì„ ì´ˆê³¼í•˜ì—¬ ì¶”ê°€ ì„œë¥˜ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
                            });
                        }
                        
                        // Show price warning
                        document.getElementById(`priceWarning-${item.id}`).classList.remove('hidden');
                        document.getElementById(`recipientRequiredBadge`).classList.remove('hidden');
                    } else {
                        document.getElementById(`priceWarning-${item.id}`).classList.add('hidden');
                    }
                    
                    // Show air validation badge
                    document.getElementById(`airValidationBadge-${item.id}`).classList.remove('hidden');
                });
            } else {
                // Hide air-specific elements
                orderItems.forEach(item => {
                    document.getElementById(`priceWarning-${item.id}`).classList.add('hidden');
                    document.getElementById(`airValidationBadge-${item.id}`).classList.add('hidden');
                });
                document.getElementById(`recipientRequiredBadge`).classList.add('hidden');
            }
            
            // General tracking number validation
            if (!trackingNumber) {
                validationMessages.push({
                    type: 'error',
                    message: 'ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.'
                });
            }
            
            updateValidationDisplay();
        }

        function validateForm() {
            validateAirShipping();
        }

        function updateValidationDisplay() {
            const container = document.getElementById('validationContainer');
            
            if (validationMessages.length > 0) {
                container.classList.remove('hidden');
                container.innerHTML = validationMessages.map(msg => {
                    const iconName = msg.type === 'error' ? 'alert-circle' : 
                                   msg.type === 'warning' ? 'alert-triangle' : 'info';
                    const bgColor = msg.type === 'error' ? 'bg-red-50 border-red-200' :
                                  msg.type === 'warning' ? 'bg-yellow-50 border-yellow-200' : 'bg-blue-50 border-blue-200';
                    const textColor = msg.type === 'error' ? 'text-red-700' :
                                    msg.type === 'warning' ? 'text-yellow-700' : 'text-blue-700';
                    
                    return `
                        <div class="p-4 border rounded-lg ${bgColor}">
                            <div class="flex items-center gap-2">
                                <i data-lucide="${iconName}" class="h-4 w-4 ${textColor}"></i>
                                <p class="${textColor}">${msg.message}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            } else {
                container.classList.add('hidden');
            }
        }

        // HS Code Search Functions
        function openHSCodeModal(itemId) {
            currentItemId = itemId;
            document.getElementById('hsCodeModal').classList.remove('hidden');
            document.getElementById('hsCodeSearch').focus();
        }

        function closeHSCodeModal() {
            document.getElementById('hsCodeModal').classList.add('hidden');
            document.getElementById('hsCodeSearch').value = '';
            document.getElementById('hsCodeResults').innerHTML = '';
            currentItemId = '';
        }

        async function searchHSCode() {
            const query = document.getElementById('hsCodeSearch').value.trim();
            
            if (!query) {
                document.getElementById('hsCodeResults').innerHTML = '<p class="text-center text-gray-500 py-4">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>';
                return;
            }
            
            document.getElementById('hsCodeLoading').classList.remove('hidden');
            
            // Simulate API call
            setTimeout(() => {
                const mockResults = [
                    { code: '1905.31', description: 'ë¹¼ë¹¼ë¡œ, ì›¨ì´í¼ ê³¼ì', category: 'ì œê³¼ë¥˜' },
                    { code: '1806.32', description: 'ì´ˆì½œë¦¿ ê³¼ì', category: 'ì œê³¼ë¥˜' },
                    { code: '1905.90', description: 'ê¸°íƒ€ ê³¼ìë¥˜', category: 'ì œê³¼ë¥˜' },
                    { code: '6203.42', description: 'ë©´ì œ ë‚¨ì„±ìš© ë°”ì§€', category: 'ì˜ë¥˜' },
                    { code: '6204.62', description: 'ë©´ì œ ì—¬ì„±ìš© ë°”ì§€', category: 'ì˜ë¥˜' },
                    { code: '6109.10', description: 'ë©´ì œ í‹°ì…”ì¸ ', category: 'ì˜ë¥˜' },
                    { code: '8517.12', description: 'íœ´ëŒ€í°', category: 'ì „ìì œí’ˆ' },
                    { code: '8471.30', description: 'íœ´ëŒ€ìš© ì»´í“¨í„°', category: 'ì „ìì œí’ˆ' },
                    { code: '3304.99', description: 'í™”ì¥í’ˆ', category: 'í™”ì¥í’ˆ' },
                    { code: '2106.90', description: 'ê±´ê°•ì‹í’ˆ', category: 'ì‹í’ˆ' },
                    { code: '9503.00', description: 'ì¥ë‚œê°', category: 'ì™„êµ¬' },
                    { code: '4202.92', description: 'ê°€ë°©', category: 'ê°€ì£½ì œí’ˆ' },
                    { code: '6403.51', description: 'ì‹ ë°œ', category: 'ì‹ ë°œë¥˜' }
                ];
                
                const filtered = mockResults.filter(item => 
                    item.code.toLowerCase().includes(query.toLowerCase()) ||
                    item.description.toLowerCase().includes(query.toLowerCase()) ||
                    item.category.toLowerCase().includes(query.toLowerCase())
                );
                
                document.getElementById('hsCodeLoading').classList.add('hidden');
                
                if (filtered.length > 0) {
                    document.getElementById('hsCodeResults').innerHTML = filtered.map(item => `
                        <div onclick="selectHSCode('${item.code}', '${item.description}')" class="p-3 border border-blue-100 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="font-medium text-blue-900">${item.code}</p>
                                    <p class="text-sm text-gray-600">${item.description}</p>
                                </div>
                                <span class="px-2 py-1 text-xs border border-gray-300 rounded-full">${item.category}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('hsCodeResults').innerHTML = `
                        <div class="p-4 text-center">
                            <p class="text-gray-500 mb-3">API ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p class="text-sm text-blue-600">ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•˜ì—¬ ì‚¬ìš©í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }, 1000);
        }

        function selectHSCode(code, description) {
            document.getElementById(`hscode-${currentItemId}`).value = code;
            document.getElementById(`description-${currentItemId}`).value = description;
            closeHSCodeModal();
        }

        // Bulk Upload Functions
        function openBulkUploadModal() {
            document.getElementById('bulkUploadModal').classList.remove('hidden');
        }

        function closeBulkUploadModal() {
            document.getElementById('bulkUploadModal').classList.add('hidden');
            document.getElementById('bulkFile').value = '';
            document.getElementById('bulkFileText').textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            document.getElementById('bulkUploadSubmitBtn').disabled = true;
        }

        function handleBulkFileSelect(e) {
            const file = e.target.files?.[0];
            if (file) {
                if (!file.name.endsWith('.csv') && !file.name.endsWith('.xlsx')) {
                    showMessage('CSV ë˜ëŠ” Excel íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                    return;
                }
                
                document.getElementById('bulkFileText').textContent = file.name;
                document.getElementById('bulkUploadSubmitBtn').disabled = false;
            }
        }

        function downloadTemplate() {
            const csvContent = `HSCODE,í’ˆëª©ëª…,ìˆ˜ëŸ‰,ì¤‘ëŸ‰(kg),ê°€ë¡œ(cm),ì„¸ë¡œ(cm),ë†’ì´(cm),ë‹¨ê°€(THB)
1905.31,ë¹¼ë¹¼ë¡œ,10,5.0,30,20,5,25.00
8517.12,íœ´ëŒ€í°,5,1.0,15,8,1,1200.00
3304.99,í™”ì¥í’ˆ,20,0.5,10,10,5,800.00`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'YCS_í’ˆëª©ì¼ê´„ë“±ë¡_ì–‘ì‹.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function processBulkUpload() {
            const file = document.getElementById('bulkFile').files[0];
            if (!file) {
                showMessage('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            setLoading(true);
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const csv = e.target?.result;
                    const lines = csv.split('\n');
                    const newItems = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',');
                        if (values.length >= 8 && values[0].trim()) {
                            const width = parseFloat(values[4]) || 0;
                            const height = parseFloat(values[5]) || 0;
                            const depth = parseFloat(values[6]) || 0;
                            
                            newItems.push({
                                hscode: values[0].trim(),
                                description: values[1].trim(),
                                quantity: parseInt(values[2]) || 1,
                                weight: parseFloat(values[3]) || 0,
                                width,
                                height,
                                depth,
                                unitPrice: parseFloat(values[7]) || 0,
                                cbm: Math.round((width * height * depth) / 1000000 * 1000) / 1000
                            });
                        }
                    }
                    
                    if (newItems.length > 0) {
                        // Clear existing items
                        document.getElementById('orderItemsContainer').innerHTML = '';
                        orderItems = [];
                        
                        // Add new items
                        newItems.forEach(item => {
                            addOrderItemWithData(item);
                        });
                        
                        closeBulkUploadModal();
                        showMessage(`${newItems.length}ê°œì˜ í’ˆëª©ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    } else {
                        showMessage('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    }
                    setLoading(false);
                } catch (err) {
                    showMessage('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    setLoading(false);
                }
            };
            
            reader.readAsText(file);
        }

        function addOrderItemWithData(data) {
            const itemId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
            addOrderItem();
            
            // Populate data
            document.getElementById(`hscode-${itemId}`).value = data.hscode;
            document.getElementById(`description-${itemId}`).value = data.description;
            document.getElementById(`quantity-${itemId}`).value = data.quantity;
            document.getElementById(`weight-${itemId}`).value = data.weight;
            document.getElementById(`width-${itemId}`).value = data.width;
            document.getElementById(`height-${itemId}`).value = data.height;
            document.getElementById(`depth-${itemId}`).value = data.depth;
            document.getElementById(`unitPrice-${itemId}`).value = data.unitPrice;
            
            // Trigger calculations
            calculateCBM(itemId);
            calculateVolumetricWeight(itemId);
        }

        // Navigation Functions
        function navigateBack() {
            window.location.href = 'dashboard.html';
        }

        // Form Actions
        function handleCancel() {
            if (confirm('ì €ì¥ë˜ì§€ ì•Šì€ ì •ë³´ëŠ” ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                navigateBack();
            }
        }

        function handleSave() {
            setLoading(true);
            setTimeout(() => {
                showMessage('ì£¼ë¬¸ì„œê°€ ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                setLoading(false);
            }, 1000);
        }

        function handleSubmit() {
            // Validation
            const errorMessages = validationMessages.filter(msg => msg.type === 'error');
            if (errorMessages.length > 0) {
                showMessage(errorMessages[0].message, 'error');
                return;
            }

            // Required fields validation
            const recipientName = document.getElementById('recipientName').value.trim();
            const recipientAddress = document.getElementById('recipientAddress').value.trim();
            const recipientPostalCode = document.getElementById('recipientPostalCode').value.trim();
            
            if (!recipientName || !recipientAddress || !recipientPostalCode) {
                showMessage('ìˆ˜ì·¨ì¸ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const hasValidItems = orderItems.some(item => {
                const description = document.getElementById(`description-${item.id}`).value.trim();
                const quantity = parseInt(document.getElementById(`quantity-${item.id}`).value) || 0;
                return description && quantity > 0;
            });
            
            if (!hasValidItems) {
                showMessage('ìµœì†Œ í•˜ë‚˜ì˜ ìœ íš¨í•œ í’ˆëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const trackingNumber = document.getElementById('trackingNumber').value.trim();
            if (!trackingNumber) {
                showMessage('ìš°ì²´êµ­ ì†¡ì¥ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            setLoading(true);
            
            setTimeout(() => {
                const receiptNumber = `YCS-${Date.now().toString().slice(-8)}`;
                showMessage(`ì ‘ìˆ˜ì™„ë£Œ! ì ‘ìˆ˜ë²ˆí˜¸: ${receiptNumber} - YCS ì°½ê³  ë„ì°© í›„ ì²­êµ¬ì„œë¥¼ ë°œí–‰í•´ë“œë¦½ë‹ˆë‹¤.`, 'success');
                setLoading(false);
                
                // Navigate to dashboard after 3 seconds
                setTimeout(() => {
                    navigateBack();
                }, 3000);
            }, 2000);
        }

        // Utility Functions
        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const alert = document.getElementById('messageAlert');
            const icon = document.getElementById('messageIcon');
            const text = document.getElementById('messageText');
            
            text.textContent = message;
            
            if (type === 'error') {
                alert.className = 'shadow-blue-lg px-6 py-4 rounded-lg flex items-center gap-3 bg-red-50 border border-red-200';
                icon.className = 'h-5 w-5 text-red-600';
                icon.setAttribute('data-lucide', 'alert-circle');
                text.className = 'text-red-700';
            } else {
                alert.className = 'shadow-blue-lg px-6 py-4 rounded-lg flex items-center gap-3 bg-green-50 border border-green-200';
                icon.className = 'h-5 w-5 text-green-600';
                icon.setAttribute('data-lucide', 'check-circle');
                text.className = 'text-green-700';
            }
            
            container.classList.remove('hidden');
            lucide.createIcons();
            
            setTimeout(() => {
                container.classList.add('hidden');
            }, type === 'success' ? 5000 : 3000);
        }

        function setLoading(loading) {
            isLoading = loading;
            const submitBtn = document.getElementById('submitBtn');
            const saveBtn = document.getElementById('saveBtn');
            
            if (loading) {
                submitBtn.innerHTML = '<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>';
                saveBtn.innerHTML = '<div class="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"></div>';
                submitBtn.disabled = true;
                saveBtn.disabled = true;
            } else {
                submitBtn.textContent = 'ì ‘ìˆ˜ì™„ë£Œ';
                saveBtn.textContent = 'ì„ì‹œì €ì¥';
                submitBtn.disabled = false;
                saveBtn.disabled = false;
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>